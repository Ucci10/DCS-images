<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCS World - Database Minacce Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Condensed:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #111921;
            --bg-tertiary: #1a2332;
            --accent-green: #00ff88;
            --accent-cyan: #00d4ff;
            --accent-red: #ff3366;
            --accent-orange: #ff9500;
            --accent-yellow: #ffd700;
            --accent-purple: #bf7fff;
            --text-primary: #e8f4f0;
            --text-secondary: #8ba4b5;
            --border-color: #2a3a4a;
            --glow-green: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Rajdhani', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .bg-grid { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(0, 255, 136, 0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 136, 0.02) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: 0; }
        header { position: relative; padding: 1.5rem 2rem; background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%); border-bottom: 1px solid var(--border-color); z-index: 10; }
        .header-content { max-width: 1800px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo-icon { width: 50px; height: 50px; background: var(--bg-tertiary); border: 2px solid var(--accent-green); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-family: 'Roboto Condensed', sans-serif; font-weight: 700; font-size: 1.2rem; color: var(--accent-green); box-shadow: var(--glow-green); }
        h1 { font-family: 'Roboto Condensed', sans-serif; font-size: 1.6rem; font-weight: 700; letter-spacing: 2px; background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { font-size: 0.9rem; color: var(--text-secondary); letter-spacing: 1px; }
        .stats-bar { display: flex; gap: 1.5rem; font-family: 'Share Tech Mono', monospace; }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; color: var(--accent-cyan); font-weight: 600; }
        .stat-label { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; }
        main { position: relative; max-width: 1800px; margin: 0 auto; padding: 1.5rem; z-index: 10; }
        .legend { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; }
        .legend-title { font-family: 'Roboto Condensed', sans-serif; font-size: 0.9rem; color: var(--accent-cyan); margin-bottom: 0.6rem; text-transform: uppercase; letter-spacing: 1px; }
        .legend-grid { display: flex; flex-wrap: wrap; gap: 1.25rem; }
        .legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.9rem; color: var(--text-secondary); }
        .filters-section { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; }
        .filters-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; font-family: 'Roboto Condensed', sans-serif; font-size: 0.9rem; color: var(--accent-green); text-transform: uppercase; letter-spacing: 2px; }
        .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 0.75rem; }
        .filter-group { display: flex; flex-direction: column; gap: 0.3rem; }
        .filter-label { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .filter-input, .filter-select { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 5px; padding: 0.5rem 0.7rem; color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; }
        .filter-input:focus, .filter-select:focus { outline: none; border-color: var(--accent-green); box-shadow: var(--glow-green); }
        .filter-select option { background: var(--bg-secondary); }
        .category-tabs { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-bottom: 1.25rem; }
        .tab-btn { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 5px; padding: 0.5rem 1rem; color: var(--text-secondary); font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; }
        .tab-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
        .tab-btn.active { background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 212, 255, 0.2)); border-color: var(--accent-green); color: var(--accent-green); }
        .tab-count { background: var(--bg-tertiary); border-radius: 3px; padding: 0.1rem 0.35rem; font-size: 0.9rem; margin-left: 0.35rem; }
        .units-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem; }
        .unit-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; transition: all 0.3s ease; cursor: pointer; position: relative; }
        .unit-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); transform: scaleX(0); transition: transform 0.3s ease; }
        .unit-card:hover { border-color: var(--accent-green); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 255, 136, 0.12); }
        .unit-card:hover::before { transform: scaleX(1); }
        .unit-image-container { position: relative; height: 110px; background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-primary) 100%); display: flex; align-items: center; justify-content: center; }
        .unit-image-container::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 25px; background: linear-gradient(transparent, var(--bg-secondary)); pointer-events: none; }
        .unit-img { width: 100%; height: 100%; object-fit: cover; }
        .unit-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border: 1px dashed var(--border-color); }
        .placeholder-text { color: var(--text-secondary); font-size: 0.9rem; text-align: center; padding: 0.4rem; font-family: 'Share Tech Mono', monospace; }
        .unit-header { display: flex; justify-content: space-between; align-items: flex-start; padding: 0.8rem; background: var(--bg-tertiary); }
        .unit-name { font-family: 'Roboto Condensed', sans-serif; font-size: 0.95rem; font-weight: 600; color: var(--text-primary); }
        .unit-designation { font-size: 0.9rem; color: var(--accent-cyan); margin-top: 0.1rem; }
        .unit-type-badge { padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; }
        .badge-aaa { background: rgba(255, 149, 0, 0.2); color: var(--accent-orange); border: 1px solid var(--accent-orange); }
        .badge-sam { background: rgba(255, 51, 102, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
        .badge-naval { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); border: 1px solid var(--accent-cyan); }
        .badge-radar { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); border: 1px solid var(--accent-green); }
        .badge-ewr { background: rgba(191, 127, 255, 0.2); color: var(--accent-purple); border: 1px solid var(--accent-purple); }
        .badge-manpads { background: rgba(255, 215, 0, 0.2); color: var(--accent-yellow); border: 1px solid var(--accent-yellow); }
        .unit-body { padding: 0.8rem; }
        .unit-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.4rem; margin-bottom: 0.6rem; }
        .unit-stat { display: flex; flex-direction: column; gap: 0.05rem; }
        .unit-stat-label { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .unit-stat-value { font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: var(--text-primary); }
        .unit-footer { display: none; }
        .rwr-symbol { background: var(--bg-primary); border: 1px solid var(--accent-green); border-radius: 3px; padding: 0.15rem 0.4rem; font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: var(--accent-green); text-shadow: 0 0 8px rgba(0, 255, 136, 0.5); }
        .harm-code { background: var(--bg-primary); border: 1px solid var(--accent-orange); border-radius: 3px; padding: 0.15rem 0.4rem; font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: var(--accent-orange); }
        .countermeasure { padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; }
        .cm-ch { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); border: 1px solid var(--accent-cyan); }
        .cm-fl { background: rgba(255, 215, 0, 0.2); color: var(--accent-yellow); border: 1px solid var(--accent-yellow); }
        .cm-ev { background: rgba(255, 51, 102, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
        .guidance-tag { font-size: 0.9rem; padding: 0.15rem 0.4rem; border-radius: 3px; text-transform: uppercase; font-weight: 600; background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); border: 1px solid var(--accent-cyan); }
        .guidance-radar { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); border: 1px solid var(--accent-cyan); }
        .guidance-optical { background: rgba(255, 215, 0, 0.2); color: var(--accent-yellow); border: 1px solid var(--accent-yellow); }
        .guidance-ir { background: rgba(255, 51, 102, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
        .threat-row { display: flex; justify-content: space-between; align-items: center; padding-top: 0.6rem; border-top: 1px solid var(--border-color); margin-top: 0.6rem; }
        .threat-section { display: flex; align-items: center; gap: 0.5rem; }
        .threat-label { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .threat-bar { display: flex; gap: 2px; }
        .threat-segment { width: 8px; height: 14px; border-radius: 2px; background: var(--bg-tertiary); border: 1px solid var(--border-color); }
        .threat-segment.active.low { background: var(--accent-green); border-color: var(--accent-green); box-shadow: 0 0 4px var(--accent-green); }
        .threat-segment.active.med { background: var(--accent-yellow); border-color: var(--accent-yellow); box-shadow: 0 0 4px var(--accent-yellow); }
        .threat-segment.active.high { background: var(--accent-orange); border-color: var(--accent-orange); box-shadow: 0 0 4px var(--accent-orange); }
        .threat-segment.active.crit { background: var(--accent-red); border-color: var(--accent-red); box-shadow: 0 0 4px var(--accent-red); }
        .tags-section { display: flex; gap: 0.4rem; align-items: center; }
        .role-tag { font-size: 0.9rem; padding: 0.1rem 0.35rem; border-radius: 3px; background: var(--bg-primary); color: var(--text-secondary); border: 1px solid var(--border-color); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 14, 20, 0.95); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; overflow-y: auto; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-secondary); border: 1px solid var(--accent-green); border-radius: 10px; max-width: 650px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 0 40px rgba(0, 255, 136, 0.2); }
        .modal-image-header { height: 180px; background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-primary) 100%); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; cursor: move; }
        .modal-image-header img { max-width: 85%; max-height: 85%; object-fit: contain; z-index: 1; transition: transform 0.1s ease-out; }
        .modal-image-header:hover img { max-width: 150%; max-height: 150%; }
        .modal-image-header .unit-placeholder { transition: transform 0.4s ease; }
        .modal-image-header:hover .unit-placeholder { transform: scale(1.3); }
        .modal-header { padding: 1rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: flex-start; }
        .modal-title { font-family: 'Roboto Condensed', sans-serif; font-size: 1.1rem; color: var(--accent-green); }
        .modal-subtitle { color: var(--accent-cyan); margin-top: 0.15rem; font-size: 0.9rem; }
        .modal-close { background: none; border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-secondary); width: 32px; height: 32px; cursor: pointer; font-size: 1.1rem; transition: all 0.3s ease; }
        .modal-close:hover { border-color: var(--accent-red); color: var(--accent-red); }
        .modal-body { padding: 1rem; }
        .modal-section { margin-bottom: 1rem; }
        .modal-section-title { font-size: 0.9rem; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 0.5rem; padding-bottom: 0.3rem; border-bottom: 1px solid var(--border-color); }
        .modal-description { color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem; }
        .modal-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.6rem; }
        .modal-stat { background: var(--bg-tertiary); padding: 0.6rem; border-radius: 5px; }
        .modal-stat-label { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.2rem; }
        .modal-stat-value { font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: var(--text-primary); }
        .radar-info { background: var(--bg-tertiary); border-radius: 6px; padding: 0.8rem; margin-top: 0.5rem; }
        .radar-info-title { font-size: 0.9rem; color: var(--accent-green); margin-bottom: 0.4rem; text-transform: uppercase; }
        .radar-info-value { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; }
        .no-results { text-align: center; padding: 2.5rem 1.5rem; color: var(--text-secondary); }
        @media (max-width: 768px) { h1 { font-size: 1.2rem; } .stats-bar { display: none; } .units-grid { grid-template-columns: 1fr; } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-green); }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">DCS</div>
                <div>
                    <h1>THREAT DATABASE</h1>
                    <p class="subtitle">by LightMaster</p>
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat"><div class="stat-value" id="total-units">0</div><div class="stat-label">Totali</div></div>
                <div class="stat"><div class="stat-value" id="visible-units">0</div><div class="stat-label">Filtrati</div></div>
            </div>
        </div>
    </header>
    <main>
        <div class="legend">
            <div class="legend-title">‚ö° Legenda</div>
            <div class="legend-grid">
                <div class="legend-item"><span class="countermeasure cm-ch">CH</span> CHAFF</div>
                <div class="legend-item"><span class="countermeasure cm-fl">FL</span> FLARE</div>
                <div class="legend-item"><span class="countermeasure cm-ev">EV</span> EVADE</div>
                <div class="legend-item"><span class="rwr-symbol">RWR</span> Simbolo RWR</div>
                <div class="legend-item"><span class="harm-code">xxx</span> HARM Code</div>
            </div>
        </div>
        <section class="filters-section">
            <div class="filters-header">‚öô Filtri</div>
            <div class="filters-grid">
                <div class="filter-group"><label class="filter-label">Cerca</label><input type="text" class="filter-input" id="search-input" placeholder="Nome, NATO, RWR..."></div>
                <div class="filter-group"><label class="filter-label">Contromisura</label><select class="filter-select" id="filter-cm"><option value="">Tutte</option><option value="CH">CHAFF</option><option value="FL">FLARE</option><option value="EV">EVADE</option></select></div>
                <div class="filter-group"><label class="filter-label">Guida</label><select class="filter-select" id="filter-guidance"><option value="">Tutte</option><option value="RADAR">Radar</option><option value="OPTICAL">Ottico</option><option value="IR">IR</option></select></div>
                <div class="filter-group"><label class="filter-label">Range Min (NM)</label><input type="number" class="filter-input" id="filter-range" placeholder="es. 10"></div>
            </div>
        </section>
        <div class="category-tabs" id="category-tabs">
            <button class="tab-btn active" data-category="all">Tutte<span class="tab-count" id="count-all">0</span></button>
            <button class="tab-btn" data-category="aaa">AAA<span class="tab-count" id="count-aaa">0</span></button>
            <button class="tab-btn" data-category="manpads">MANPADS<span class="tab-count" id="count-manpads">0</span></button>
            <button class="tab-btn" data-category="sam">SAM<span class="tab-count" id="count-sam">0</span></button>
            <button class="tab-btn" data-category="radar">Radar<span class="tab-count" id="count-radar">0</span></button>
            <button class="tab-btn" data-category="ewr">EWR<span class="tab-count" id="count-ewr">0</span></button>
            <button class="tab-btn" data-category="naval">Naval<span class="tab-count" id="count-naval">0</span></button>
        </div>
        <div class="units-grid" id="units-grid"></div>
        <div class="no-results" id="no-results" style="display: none;"><h3>üéØ Nessuna minaccia trovata</h3><p>Modifica i filtri</p></div>
    </main>
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-image-header" id="modal-image"></div>
            <div class="modal-header">
                <div><h2 class="modal-title" id="modal-title"></h2><p class="modal-subtitle" id="modal-subtitle"></p></div>
                <button class="modal-close" id="modal-close">√ó</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>
    <script>
        function getImagePath(u) { return `images/${u.category}/${u.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '')}.png`; }

        const db = [
            // AAA - threatLevel 1-10 based on lethality
            {id:1,name:"ZU-23-3 Sergey",category:"aaa",rwrSymbol:"-",harmCode:"-",rangeNM:1.3,altKFt:6.5,acquireTime:4,guidance:"OPTICAL",countermeasure:"EV",threatLevel:3,ammo:"100 rounds",description:"Cannone antiaereo trainato da 23mm a doppia canna con puntamento ottico.",history:"In servizio dal 1960, esportato in oltre 50 paesi.",technicalNotes:"Cadenza: 800-1000 colpi/min per canna."},
            {id:2,name:"ZSU-23-4 Shilka",category:"aaa",rwrSymbol:"A",harmCode:"121",rangeNM:1.3,altKFt:6.5,acquireTime:8,guidance:"RADAR",countermeasure:"CH",threatLevel:5,ammo:"2000 rounds",description:"SPAAG sovietico con quattro cannoni 23mm e radar RPK-2 Gun Dish.",history:"Efficace durante la Guerra dello Yom Kippur 1973.",technicalNotes:"Radar RPK-2: 20km. Cadenza: 3400 colpi/min."},
            {id:3,name:"ZSU-57-2 Sparka",category:"aaa",rwrSymbol:"-",harmCode:"-",rangeNM:2,altKFt:14,acquireTime:5,guidance:"OPTICAL",countermeasure:"EV",threatLevel:4,ammo:"254 rounds",description:"Semovente con doppio cannone da 57mm su scafo T-54.",technicalNotes:"Proiettile: 2.8kg HE-FRAG. Cadenza: 120 colpi/min."},
            {id:4,name:"ZPU-1/2/4",category:"aaa",rwrSymbol:"-",harmCode:"-",rangeNM:0.7,altKFt:4.5,acquireTime:3.5,guidance:"OPTICAL",countermeasure:"EV",threatLevel:2,ammo:"4800 rounds",description:"Mitragliatrici KPV da 14.5mm in configurazioni 1, 2 o 4 canne.",technicalNotes:"Proiettile: 14.5x114mm. Penetrazione: 32mm a 500m."},
            {id:5,name:"Flakpanzer Gepard",category:"aaa",rwrSymbol:"A",harmCode:"207",rangeNM:2,altKFt:9.5,acquireTime:4,guidance:"RADAR",countermeasure:"CH",threatLevel:6,ammo:"660 rounds",description:"SPAAG tedesco con doppi Oerlikon 35mm e radar sofisticato su Leopard 1.",history:"Fornito all'Ucraina nel 2022.",technicalNotes:"Radar ricerca: 15km. Proiettili AHEAD programmabili."},
            {id:6,name:"M163 Vulcan",category:"aaa",rwrSymbol:"A",harmCode:"208",rangeNM:1.4,altKFt:4.5,acquireTime:6,guidance:"OPTICAL",countermeasure:"EV",threatLevel:4,ammo:"2280 rounds",description:"VADS americano con cannone M168 Vulcan 20mm rotante su M113.",technicalNotes:"Cadenza: 3000 colpi/min."},
            {id:7,name:"2K22M Tunguska",natoDesignation:"SA-19 Grison",category:"aaa",rwrSymbol:"19",harmCode:"120",rangeNM:4,altKFt:16,acquireTime:8,guidance:"RADAR",countermeasure:"EV",threatLevel:7,ammo:"1936 rds + 8 missiles",description:"Sistema ibrido 2x30mm (5000 colpi/min) + 8 missili 9M311.",technicalNotes:"Radar Hot Shot: 18km. Missili: 8km SACLOS."},
            // MANPADS
            {id:8,name:"9K38 Igla",natoDesignation:"SA-18 Grouse",category:"manpads",rwrSymbol:"-",harmCode:"-",rangeNM:2.5,altKFt:11,acquireTime:6,guidance:"IR",countermeasure:"FL",threatLevel:4,ammo:"1 missile",description:"MANPADS sovietico a guida IR con capacit√† all-aspect.",history:"Usato estensivamente in Afghanistan, Cecenia e Ucraina.",technicalNotes:"Cercatore IR raffreddato. Testata 1.17kg. Velocit√†: Mach 1.9."},
            {id:9,name:"9K338 Igla-S",natoDesignation:"SA-24 Grinch",category:"manpads",rwrSymbol:"-",harmCode:"-",rangeNM:3,altKFt:12,acquireTime:5,guidance:"IR",countermeasure:"FL",threatLevel:5,ammo:"1 missile",description:"Versione migliorata dell'Igla con IRCCM avanzato.",history:"In servizio dal 2004. Esportato in oltre 20 paesi.",technicalNotes:"Testata 2.5kg. Resistenza ai flare migliorata del 50%."},
            {id:100,name:"FIM-92 Stinger",category:"manpads",rwrSymbol:"-",harmCode:"-",rangeNM:2.5,altKFt:12.5,acquireTime:5,guidance:"IR",countermeasure:"FL",threatLevel:4,ammo:"1 missile",description:"MANPADS americano con cercatore IR passivo a doppia banda.",history:"Famoso per l'uso in Afghanistan contro i sovietici. Oltre 270 abbattimenti confermati.",technicalNotes:"Cercatore IR/UV. Testata 3kg HE-FRAG. Velocit√†: Mach 2.2."},
            {id:101,name:"Mistral",category:"manpads",rwrSymbol:"-",harmCode:"-",rangeNM:3,altKFt:10,acquireTime:5,guidance:"IR",countermeasure:"FL",threatLevel:4,ammo:"1 missile",description:"MANPADS francese ad alte prestazioni.",history:"In servizio dal 1988. Usato su veicoli, elicotteri e navi.",technicalNotes:"Cercatore IR a 2 colori. Testata 3kg. Velocit√†: Mach 2.5."},
            {id:102,name:"9K32 Strela-2",natoDesignation:"SA-7 Grail",category:"manpads",rwrSymbol:"-",harmCode:"-",rangeNM:2,altKFt:8,acquireTime:8,guidance:"IR",countermeasure:"FL",threatLevel:3,ammo:"1 missile",description:"Primo MANPADS sovietico. Solo ingaggio in coda.",history:"Il MANPADS pi√π diffuso al mondo. Usato in ogni conflitto dal 1968.",technicalNotes:"Cercatore IR non raffreddato. Testata 1.15kg."},
            // SAM
            {id:10,name:"S-75 Dvina",natoDesignation:"SA-2 Guideline",category:"sam",rwrSymbol:"2",harmCode:"126",rangeNM:24,altKFt:82,guidance:"RADAR",countermeasure:"CH",threatLevel:6,trackRadar:"SNR-75 Fan Song",searchRadar:"P-12 Spoon Rest",description:"SAM strategico sovietico. Primo ad abbattere un aereo (U-2, 1960).",history:"Centinaia di abbattimenti in Vietnam e Medio Oriente.",technicalNotes:"Missile V-750: 10.6m, 2300kg."},
            {id:11,name:"S-125 Neva/Pechora",natoDesignation:"SA-3 Goa",category:"sam",rwrSymbol:"3",harmCode:"123",rangeNM:12,altKFt:59,guidance:"RADAR",countermeasure:"CH",threatLevel:6,trackRadar:"SNR-125 Low Blow",searchRadar:"P-19 Flat Face",description:"SAM bassa/media quota. Complementare all'SA-2.",history:"Un SA-3 serbo abbatt√© un F-117 nel 1999.",technicalNotes:"Missile 5V27: Mach 3.5, testata 70kg."},
            {id:12,name:"S-200 Vega",natoDesignation:"SA-5 Gammon",category:"sam",rwrSymbol:"5",harmCode:"129",rangeNM:162,altKFt:130,guidance:"RADAR",countermeasure:"CH",threatLevel:8,trackRadar:"5N26 Square Pair",searchRadar:"P-14 Tall King",description:"SAM strategico a lunghissimo raggio contro bombardieri e AWACS.",technicalNotes:"Missile 5V28: 10.8m, 7100kg, portata 300km."},
            {id:13,name:"2K12 Kub",natoDesignation:"SA-6 Gainful",category:"sam",rwrSymbol:"6",harmCode:"108",rangeNM:19,altKFt:33,guidance:"RADAR",countermeasure:"CH",threatLevel:7,trackRadar:"1S91 Straight Flush",searchRadar:"P-12 Spoon Rest",description:"SAM mobile tattico con motore ramjet.",history:"Devastante nella Guerra dello Yom Kippur 1973.",technicalNotes:"Missile 3M9: Mach 2.8, ramjet integrale."},
            {id:14,name:"9K33 Osa",natoDesignation:"SA-8 Gecko",category:"sam",rwrSymbol:"8",harmCode:"117",rangeNM:8,altKFt:21,guidance:"RADAR",countermeasure:"CH",threatLevel:6,trackRadar:"Land Roll (integrato)",description:"Primo SAM completamente autonomo su singolo veicolo anfibio.",technicalNotes:"Radar: ricerca 27km, tracking 20km. Missile: Mach 2."},
            {id:15,name:"9K31 Strela-1",natoDesignation:"SA-9 Gaskin",category:"sam",rwrSymbol:"-",harmCode:"-",rangeNM:3,altKFt:12,guidance:"IR",countermeasure:"FL",threatLevel:4,description:"SAM IR a corto raggio su BRDM-2.",technicalNotes:"Cercatore IR non raffreddato, solo coda."},
            {id:16,name:"S-300PS",natoDesignation:"SA-10 Grumble",category:"sam",rwrSymbol:"10",harmCode:"110",rangeNM:40,altKFt:160,guidance:"RADAR",countermeasure:"CH",threatLevel:10,trackRadar:"30N6E Flap Lid",searchRadar:"64H6E Big Bird, 5N66M Clam Shell",description:"Sistema SAM strategico. 100 bersagli, 12 ingaggi simultanei.",history:"Esportato in Cina, Iran, Siria. Ha ridefinito la difesa aerea.",technicalNotes:"Missile 5V55: Mach 6, 20G. Setup: 5 min."},
            {id:17,name:"9K37 Buk",natoDesignation:"SA-11 Gadfly",category:"sam",rwrSymbol:"11",harmCode:"115",rangeNM:19,altKFt:45,guidance:"RADAR",countermeasure:"CH",threatLevel:8,trackRadar:"Fire Dome (TELAR)",searchRadar:"9S18M1 Snow Drift",description:"SAM medio raggio con TELAR semi-autonomo.",history:"Abbatt√© il volo MH17 nel 2014.",technicalNotes:"Missile 9M38: 5.5m, 690kg, Mach 3."},
            {id:18,name:"9K35 Strela-10",natoDesignation:"SA-13 Gopher",category:"sam",rwrSymbol:"13",harmCode:"118",rangeNM:3,altKFt:15,guidance:"IR",countermeasure:"FL",threatLevel:5,trackRadar:"Snap Shot",description:"SAM IR su scafo MT-LB. Evoluzione dell'SA-9.",technicalNotes:"Cercatore IR raffreddato. Missile 9M37: Mach 2."},
            {id:19,name:"9K331 Tor",natoDesignation:"SA-15 Gauntlet",category:"sam",rwrSymbol:"15",harmCode:"119",rangeNM:7,altKFt:26,guidance:"RADAR",countermeasure:"CH",threatLevel:8,trackRadar:"Scrum Half",description:"SHORAD avanzato anti-cruise missile. Reazione 5-8 sec.",history:"Efficace in Siria contro droni.",technicalNotes:"Radar phased array, 48 bersagli. Missile: Mach 2.8, 30G."},
            {id:20,name:"HQ-7",category:"sam",rwrSymbol:"7",harmCode:"127",rangeNM:8,altKFt:20,guidance:"RADAR",countermeasure:"EV",threatLevel:5,description:"SAM cinese basato sul Crotale francese.",technicalNotes:"Versione navale: HHQ-7."},
            {id:21,name:"Rapier",category:"sam",rwrSymbol:"RT",harmCode:"125",rangeNM:4.4,altKFt:6.3,guidance:"RADAR",countermeasure:"CH",threatLevel:5,trackRadar:"Blindfire",description:"SAM britannico a corto raggio.",history:"Usato nelle Falklands 1982.",technicalNotes:"Guida SACLOS, Mach 2.5."},
            {id:22,name:"MIM-115 Roland",category:"sam",rwrSymbol:"RO",harmCode:"201",rangeNM:3.4,altKFt:20,guidance:"RADAR",countermeasure:"CH",threatLevel:5,trackRadar:"Roland ADS",searchRadar:"Roland EWR",description:"SAM franco-tedesco a corto raggio.",technicalNotes:"Mach 1.6, guida SACLOS. 2+8 missili."},
            {id:23,name:"MIM-23 Hawk",category:"sam",rwrSymbol:"HK",harmCode:"204",rangeNM:26,altKFt:45,guidance:"RADAR",countermeasure:"CH",threatLevel:7,trackRadar:"AN/MPQ-46 HPIR, AN/MPQ-55 CWAR",searchRadar:"AN/MPQ-50 PAR",description:"SAM NATO a media quota. Guida SARH continua.",history:"In servizio dal 1960. Ancora operativo.",technicalNotes:"Missile MIM-23B: 5.1m, Mach 2.4."},
            {id:24,name:"NASAMS",category:"sam",rwrSymbol:"NS",harmCode:"209",rangeNM:15,altKFt:50,guidance:"RADAR",countermeasure:"CH",threatLevel:8,trackRadar:"AN/MPQ-64F1 Sentinel",description:"Sistema norvegese-americano con AIM-120 AMRAAM da terra.",history:"Eccellente in Ucraina contro droni e cruise.",technicalNotes:"Pu√≤ usare anche AIM-9X. Network-centrico."},
            {id:25,name:"MIM-104 Patriot",category:"sam",rwrSymbol:"P",harmCode:"202",rangeNM:48,altKFt:80,guidance:"RADAR",countermeasure:"CH",threatLevel:10,trackRadar:"AN/MPQ-53/65 STR",description:"SAM strategico USA. Capacit√† ABM con PAC-2/3.",history:"Famoso dalla Guerra del Golfo 1991.",technicalNotes:"Radar phased array, 100+ bersagli."},
            // RADAR
            {id:30,name:"SNR-75 Fan Song",category:"radar",associatedSam:"SA-2",rwrSymbol:"2",harmCode:"126",rangeNM:24,altKFt:82,role:"TR",description:"Radar controllo fuoco per S-75/SA-2.",technicalNotes:"Banda E/F. Guida comando + SARH."},
            {id:31,name:"SNR-125 Low Blow",category:"radar",associatedSam:"SA-3",rwrSymbol:"3",harmCode:"123",rangeNM:12,altKFt:59,role:"TR",description:"Radar tracking per S-125/SA-3.",technicalNotes:"Banda I. Tracking: 80km. CW."},
            {id:32,name:"5N26 Square Pair",category:"radar",associatedSam:"SA-5",rwrSymbol:"5",harmCode:"129",rangeNM:162,altKFt:130,role:"TR",description:"Radar tracking per S-200.",technicalNotes:"Banda H. Portata 270km."},
            {id:33,name:"1S91 Straight Flush",category:"radar",associatedSam:"SA-6",rwrSymbol:"6",harmCode:"108",rangeNM:19,altKFt:33,role:"STR",description:"Radar multifunzione per SA-6. Ricerca+tracking+guida.",history:"Sorpresa per Israele nel 1973.",technicalNotes:"Ricerca: 75km. Tracking CW: 0.5 mrad."},
            {id:34,name:"30N6E Flap Lid",category:"radar",associatedSam:"SA-10",rwrSymbol:"10",harmCode:"110",rangeNM:40,altKFt:160,role:"TR",description:"Radar ingaggio S-300. Phased array, 12 missili vs 6 bersagli.",technicalNotes:"Tracking: 300km. Resistente ECM."},
            {id:35,name:"AN/MPQ-53/65",category:"radar",associatedSam:"Patriot",rwrSymbol:"P",harmCode:"202",rangeNM:48,altKFt:80,role:"STR",description:"Radar phased array multifunzione Patriot.",technicalNotes:"100+ bersagli. MPQ-65 per PAC-3."},
            {id:36,name:"AN/MPQ-46 HPIR",category:"radar",associatedSam:"Hawk",rwrSymbol:"HK",harmCode:"204",rangeNM:26,altKFt:45,role:"TR",description:"High Power Illuminator Radar per Hawk.",technicalNotes:"Banda X. CW per SARH."},
            {id:37,name:"AN/MPQ-55 CWAR",category:"radar",associatedSam:"Hawk",rwrSymbol:"HK",harmCode:"206",rangeNM:26,altKFt:45,role:"TR",description:"Continuous Wave Acquisition Radar Hawk.",technicalNotes:"Allarme 360¬∞."},
            {id:38,name:"AN/MPQ-50 PAR",category:"radar",associatedSam:"Hawk",rwrSymbol:"HK",harmCode:"203",rangeNM:26,altKFt:45,role:"SR",description:"Pulse Acquisition Radar Hawk.",technicalNotes:"Banda X. Dati iniziali al HPIR."},
            {id:39,name:"P-19 Flat Face",category:"radar",associatedSam:"SA-3",rwrSymbol:"S",harmCode:"122",rangeNM:15,altKFt:59,role:"SR",description:"Radar acquisizione 2D per SA-3.",technicalNotes:"Banda C/D. Portata: 175km."},
            {id:40,name:"64H6E Big Bird",category:"radar",associatedSam:"SA-10",rwrSymbol:"BB",harmCode:"104",rangeNM:40,altKFt:160,role:"SR",description:"Radar sorveglianza 3D per S-300.",technicalNotes:"Portata: 300km. Torre telescopica."},
            {id:41,name:"5N66M Clam Shell",category:"radar",associatedSam:"SA-10",rwrSymbol:"CS",harmCode:"103",rangeNM:40,altKFt:160,role:"SR (L)",description:"Radar bassa quota per S-300.",technicalNotes:"Ottimizzato per cruise missiles."},
            {id:42,name:"9S18M1 Snow Drift",category:"radar",associatedSam:"SA-11",rwrSymbol:"SD",harmCode:"107",rangeNM:19,altKFt:45,role:"SR",description:"Radar sorveglianza per batteria Buk.",technicalNotes:"Portata: 160km."},
            {id:43,name:"9S80M1 Dog Ear",category:"radar",associatedSam:"SA-8/9/13",rwrSymbol:"DE",harmCode:"109",rangeNM:8,altKFt:21,role:"SR",description:"Radar sorveglianza PPRU Sborka per SHORAD.",technicalNotes:"Portata: 80km. Su MT-LBu."},
            {id:44,name:"Roland EWR",category:"radar",associatedSam:"Roland",rwrSymbol:"RO",harmCode:"205",rangeNM:3.4,altKFt:20,role:"SR",description:"Early Warning Radar per Roland."},
            {id:45,name:"ST-68U Tin Shield",category:"radar",rwrSymbol:"TS",harmCode:"130",role:"SR",description:"Radar sorveglianza 3D mobile.",technicalNotes:"Banda F. Portata: 400km."},
            {id:46,name:"AN/MPQ-64F1 Sentinel",category:"radar",associatedSam:"NASAMS",rwrSymbol:"NS",harmCode:"209",rangeNM:40,altKFt:50,role:"SR",description:"Radar 3D phased array per NASAMS.",technicalNotes:"Banda X. Range: 75km."},
            // EWR
            {id:50,name:"1L13 Box Spring",category:"ewr",rwrSymbol:"S",harmCode:"101",rangeKM:500,altKM:40,role:"EWR",description:"Radar allarme precoce 3D VHF. Capacit√† anti-stealth.",technicalNotes:"Banda VHF. Array dipoli."},
            {id:51,name:"55G6 Tall Rack",category:"ewr",rwrSymbol:"S",harmCode:"102",rangeKM:500,altKM:40,role:"EWR",description:"Radar NEBO VHF alta quota.",technicalNotes:"Stazionario dispiegabile."},
            {id:52,name:"P-37 Bar Lock",category:"ewr",rwrSymbol:"S",harmCode:"-",role:"EWR",description:"Radar GCI allarme precoce."},
            {id:53,name:"PRV-11 Side Net",category:"ewr",rwrSymbol:"S",harmCode:"-",role:"EWR",description:"Radar altimetrico.",technicalNotes:"Antenna nodding."},
            {id:54,name:"P-12 Spoon Rest",category:"ewr",associatedSam:"SA-2, SA-6",rwrSymbol:"S",harmCode:"-",rangeNM:24,altKFt:82,role:"EWR/SR",description:"Radar allarme e acquisizione per SA-2/SA-6.",technicalNotes:"Banda VHF. Portata: 250km."},
            {id:55,name:"P-14 Tall King",category:"ewr",associatedSam:"SA-5",rwrSymbol:"S",harmCode:"-",rangeNM:162,altKFt:130,role:"EWR",description:"EWR lunghissimo raggio per SA-5.",technicalNotes:"Banda VHF. Portata: 600km."},
            {id:56,name:"P-18 Spoon Rest D",category:"ewr",rwrSymbol:"S",harmCode:"-",role:"EWR",description:"Versione modernizzata P-12.",technicalNotes:"ECCM potenziato."},
            {id:57,name:"P-40 Long Track",category:"ewr",rwrSymbol:"S",harmCode:"-",role:"EWR",description:"Radar EWR 3D su veicolo cingolato.",technicalNotes:"Mobile. Portata: 350km."},
            // NAVAL
            {id:60,name:"CVN-70 Carl Vinson",category:"naval",rwrSymbol:"SS",harmCode:"402",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Portaerei nucleare classe Nimitz. 90+ velivoli.",technicalNotes:"100.000 ton. 4 catapulte."},
            {id:61,name:"CVN-71 Theodore Roosevelt",alias:"Rough Rider",category:"naval",rwrSymbol:"SS",harmCode:"403",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Portaerei Nimitz con design migliorato."},
            {id:62,name:"CVN-72 Abraham Lincoln",alias:"Union",category:"naval",rwrSymbol:"SS",harmCode:"404",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Portaerei nucleare Nimitz."},
            {id:63,name:"CVN-73 George Washington",alias:"Warfighter",category:"naval",rwrSymbol:"SS",harmCode:"405",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Portaerei Nimitz. Forward deployed Yokosuka."},
            {id:64,name:"CVN-74 John C. Stennis",alias:"Courage",category:"naval",rwrSymbol:"SS",harmCode:"406",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Portaerei Nimitz.",technicalNotes:"Reattori A4W: 50 anni."},
            {id:65,name:"CVN-75 Harry S. Truman",alias:"Lone Warrior",category:"naval",rwrSymbol:"SS",harmCode:"413",rangeNM:14,altKFt:35,shipType:"CV",countermeasure:"CH",description:"Ultima portaerei classe Nimitz."},
            {id:66,name:"Kuznetsov (pre-2017)",category:"naval",rwrSymbol:"SW",harmCode:"301",rangeNM:9,altKFt:20,shipType:"CV",countermeasure:"CH",description:"Portaerei STOBAR russa con ski-jump.",technicalNotes:"55.000 ton. Su-33, MiG-29K. P-700 Granit."},
            {id:67,name:"Kuznetsov (post-2017)",category:"naval",rwrSymbol:"SW",harmCode:"320",rangeNM:9,altKFt:20,shipType:"CV",countermeasure:"CH",description:"Kuznetsov post modernizzazione 2017."},
            {id:68,name:"Tarawa",category:"naval",rwrSymbol:"40",harmCode:"407",rangeNM:8,altKFt:13,shipType:"CV",countermeasure:"FL",description:"LHA classe Tarawa. Marines, elicotteri, AV-8B.",technicalNotes:"40.000 ton. 1900 Marines."},
            {id:69,name:"Ticonderoga",category:"naval",rwrSymbol:"AE",harmCode:"315",rangeNM:55,shipType:"CR",countermeasure:"CH",samSystems:"SM-2, SM-6, ESSM",ciws:"2x Phalanx",description:"Incrociatore AEGIS. Centro difesa aerea flotta.",history:"USS Vincennes abbatt√© Airbus iraniano 1988.",technicalNotes:"SPY-1A/B: 200+ bersagli. VLS Mk41: 122 celle."},
            {id:70,name:"Arleigh Burke IIa",category:"naval",rwrSymbol:"AE",harmCode:"412",rangeNM:57,shipType:"DE",countermeasure:"CH",samSystems:"SM-2, SM-3, SM-6",ciws:"Phalanx",description:"Cacciatorpediniere AEGIS. 70+ unit√†. BMD capable.",technicalNotes:"SPY-1D. VLS: 96 celle. Flight III: SPY-6."},
            {id:71,name:"Perry",alias:"Fig Seven",category:"naval",rwrSymbol:"49",harmCode:"426",rangeNM:50,shipType:"FR",countermeasure:"CH",description:"Fregata Oliver Hazard Perry.",technicalNotes:"AN/SPS-49. Mk13 per SM-1."},
            {id:72,name:"Pyotr Velikiy",category:"naval",rwrSymbol:"HN",harmCode:"313",rangeNM:74,shipType:"CR",countermeasure:"CH",samSystems:"SA-N-6, SA-N-9",ciws:"6x Kashtan",description:"Incrociatore nucleare Kirov. Pi√π grande nave dopo CV.",technicalNotes:"28.000 ton. 20x P-700 Granit."},
            {id:73,name:"Moskva",category:"naval",rwrSymbol:"T2",harmCode:"303",rangeNM:47,shipType:"CR",countermeasure:"CH",samSystems:"SA-N-6",description:"Incrociatore classe Slava. Ex-ammiraglia Mar Nero.",history:"Affondata 2022 da missili Neptune ucraini.",technicalNotes:"12.000 ton. 16x P-500 Bazalt."},
            {id:74,name:"052C Haikou",category:"naval",rwrSymbol:"HN",harmCode:"410",rangeNM:64,shipType:"DE",countermeasure:"CH",description:"Cacciatorpediniere cinese 'Chinese AEGIS'.",technicalNotes:"Radar Type 348 AESA. VLS HHQ-9."},
            {id:75,name:"052B Guangzhou",category:"naval",rwrSymbol:"MR",harmCode:"409",rangeNM:27,altKFt:48,shipType:"DE",countermeasure:"CH",description:"Cacciatorpediniere cinese con sistemi russi.",technicalNotes:"SA-N-12, radar Top Plate."},
            {id:76,name:"054A Yantai",category:"naval",rwrSymbol:"MR",harmCode:"411",rangeNM:35,shipType:"FR",countermeasure:"CH",description:"Fregata cinese Tipo 054A. Classe pi√π numerosa PLAN.",technicalNotes:"VLS HHQ-16. 30+ unit√†."},
            {id:77,name:"Grisha/Albatros",category:"naval",rwrSymbol:"HP",harmCode:"306",rangeNM:8,altKFt:17,shipType:"VE",countermeasure:"CH",description:"Corvetta ASW classe Grisha.",technicalNotes:"1200 ton. SA-N-4."},
            {id:78,name:"Molniya",category:"naval",rwrSymbol:"PS",harmCode:"312",rangeNM:4,altKFt:9,shipType:"VE",countermeasure:"EV",description:"Corvetta missilistica Tarantul.",technicalNotes:"500 ton. 4x P-270 Moskit. 42 nodi."},
            {id:79,name:"071 Amphibious",category:"naval",rwrSymbol:"PS",harmCode:"408",rangeNM:4,altKFt:9,shipType:"TT",countermeasure:"EV",description:"LPD cinese Tipo 071 Yuzhao.",technicalNotes:"25.000 ton. 4 LCAC, 800 Marines."},
            {id:80,name:"Rezky",category:"naval",rwrSymbol:"TP",harmCode:"309",rangeNM:8,altKFt:17,shipType:"FR",countermeasure:"CH",description:"Fregata classe Krivak.",technicalNotes:"3500 ton. SA-N-4. SS-N-14."},
            {id:81,name:"Neustrashimy",category:"naval",rwrSymbol:"TP",harmCode:"319",rangeNM:9,altKFt:20,shipType:"FR",countermeasure:"CH",description:"Fregata moderna russa.",technicalNotes:"4400 ton. SA-N-9. Kortik CIWS."}
        ];

        let currentCategory = 'all';
        let filtered = [...db];
        const grid = document.getElementById('units-grid');
        const modal = document.getElementById('modal-overlay');

        function init() {
            const c = {all:db.length, aaa:db.filter(u=>u.category==='aaa').length, manpads:db.filter(u=>u.category==='manpads').length, sam:db.filter(u=>u.category==='sam').length, radar:db.filter(u=>u.category==='radar').length, ewr:db.filter(u=>u.category==='ewr').length, naval:db.filter(u=>u.category==='naval').length};
            Object.keys(c).forEach(k => { const el = document.getElementById(`count-${k}`); if(el) el.textContent = c[k]; });
            document.getElementById('total-units').textContent = db.length;
            render();
            document.getElementById('category-tabs').addEventListener('click', e => { const btn = e.target.closest('.tab-btn'); if(!btn) return; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); currentCategory = btn.dataset.category; doFilter(); });
            document.getElementById('search-input').addEventListener('input', doFilter);
            document.getElementById('filter-cm').addEventListener('change', doFilter);
            document.getElementById('filter-guidance').addEventListener('change', doFilter);
            document.getElementById('filter-range').addEventListener('input', doFilter);
            document.getElementById('modal-close').addEventListener('click', () => modal.classList.remove('active'));
            modal.addEventListener('click', e => { if(e.target === modal) modal.classList.remove('active'); });
            document.addEventListener('keydown', e => { if(e.key === 'Escape') modal.classList.remove('active'); });
        }

        function doFilter() {
            const s = document.getElementById('search-input').value.toLowerCase();
            const cm = document.getElementById('filter-cm').value;
            const g = document.getElementById('filter-guidance').value;
            const r = parseFloat(document.getElementById('filter-range').value) || 0;
            filtered = db.filter(u => {
                if(currentCategory !== 'all' && u.category !== currentCategory) return false;
                if(s && !u.name.toLowerCase().includes(s) && !(u.natoDesignation && u.natoDesignation.toLowerCase().includes(s)) && !(u.rwrSymbol && u.rwrSymbol.toLowerCase() === s) && !(u.harmCode && u.harmCode.includes(s)) && !(u.alias && u.alias.toLowerCase().includes(s))) return false;
                if(cm && u.countermeasure !== cm) return false;
                if(g && u.guidance !== g) return false;
                if(r > 0 && (u.rangeNM || 0) < r) return false;
                return true;
            });
            document.getElementById('visible-units').textContent = filtered.length;
            render();
        }

        function render() {
            const nr = document.getElementById('no-results');
            if(filtered.length === 0) { grid.innerHTML = ''; nr.style.display = 'block'; return; }
            nr.style.display = 'none';
            grid.innerHTML = filtered.map(u => {
                const cat = {aaa:'AAA',manpads:'MANPADS',sam:'SAM',radar:'RADAR',ewr:'EWR',naval:'NAVAL'}[u.category];
                const gC = u.guidance ? `guidance-${u.guidance.toLowerCase()}` : '';
                const gLabel = u.guidance === 'RADAR' ? 'Radar' : u.guidance === 'IR' ? 'IR' : u.guidance === 'OPTICAL' ? 'Ottico' : '';
                // Threat bar segments
                const tl = u.threatLevel || 0;
                let threatBar = '';
                for(let i = 1; i <= 10; i++) {
                    let cls = i <= tl ? 'active ' : '';
                    if(i <= 3) cls += 'low';
                    else if(i <= 5) cls += 'med';
                    else if(i <= 7) cls += 'high';
                    else cls += 'crit';
                    threatBar += `<div class="threat-segment ${i <= tl ? cls : ''}"></div>`;
                }
                return `<div class="unit-card" data-id="${u.id}">
                    <div class="unit-image-container">
                        <img src="${getImagePath(u)}" alt="${u.name}" class="unit-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
                        <div class="unit-placeholder" style="display:none;"><span class="placeholder-text">${u.name}</span></div>
                    </div>
                    <div class="unit-header">
                        <div>
                            <div class="unit-name">${u.name}</div>
                            ${u.natoDesignation ? `<div class="unit-designation">${u.natoDesignation}</div>` : ''}
                            ${u.alias ? `<div class="unit-designation">"${u.alias}"</div>` : ''}
                        </div>
                        <span class="unit-type-badge badge-${u.category}">${cat}</span>
                    </div>
                    <div class="unit-body">
                        <div class="unit-stats">
                            <div class="unit-stat"><span class="unit-stat-label">Range</span><span class="unit-stat-value">${u.rangeNM ? u.rangeNM+' NM' : u.rangeKM ? u.rangeKM+' km' : '-'}</span></div>
                            <div class="unit-stat"><span class="unit-stat-label">Alt</span><span class="unit-stat-value">${u.altKFt ? u.altKFt+'k ft' : u.altKM ? u.altKM+' km' : '-'}</span></div>
                            <div class="unit-stat"><span class="unit-stat-label">RWR</span>${u.rwrSymbol && u.rwrSymbol !== '-' ? `<span class="rwr-symbol">${u.rwrSymbol}</span>` : '<span class="unit-stat-value">-</span>'}</div>
                            <div class="unit-stat"><span class="unit-stat-label">HARM</span>${u.harmCode && u.harmCode !== '-' ? `<span class="harm-code">${u.harmCode}</span>` : '<span class="unit-stat-value">-</span>'}</div>
                        </div>
                        ${(u.threatLevel || u.guidance) ? `<div class="threat-row">
                            <div class="threat-section">
                                <span class="threat-label">MINACCIA</span>
                                <div class="threat-bar">${threatBar}</div>
                            </div>
                            <div class="tags-section">
                                ${u.guidance ? `<span class="guidance-tag ${gC}">${gLabel}</span>` : ''}
                                ${u.role ? `<span class="role-tag">${u.role}</span>` : ''}
                                ${u.shipType ? `<span class="role-tag">${u.shipType}</span>` : ''}
                            </div>
                        </div>` : ''}
                    </div>
                </div>`;
            }).join('');
            document.querySelectorAll('.unit-card').forEach(c => c.addEventListener('click', () => { const u = db.find(x => x.id === parseInt(c.dataset.id)); if(u) openModal(u); }));
        }

        function openModal(u) {
            document.getElementById('modal-image').innerHTML = `<img src="${getImagePath(u)}" alt="${u.name}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';"><div class="unit-placeholder" style="display:none;width:60%;height:60%;"><span class="placeholder-text">${u.name}</span></div>`;
            document.getElementById('modal-title').textContent = u.name;
            document.getElementById('modal-subtitle').textContent = u.natoDesignation || u.alias || '';
            let h = `<div class="modal-section"><h3 class="modal-section-title">üìã Descrizione</h3><p class="modal-description">${u.description||'-'}</p>${u.history?`<div class="radar-info"><div class="radar-info-title">üìú Storia</div><div class="radar-info-value">${u.history}</div></div>`:''}${u.technicalNotes?`<div class="radar-info"><div class="radar-info-title">‚öôÔ∏è Note Tecniche</div><div class="radar-info-value">${u.technicalNotes}</div></div>`:''}</div><div class="modal-section"><h3 class="modal-section-title">üìä Specifiche</h3><div class="modal-stats-grid"><div class="modal-stat"><div class="modal-stat-label">Range</div><div class="modal-stat-value">${u.rangeNM?u.rangeNM+' NM':u.rangeKM?u.rangeKM+' km':'-'}</div></div><div class="modal-stat"><div class="modal-stat-label">Alt Max</div><div class="modal-stat-value">${u.altKFt?u.altKFt+'k ft':u.altKM?u.altKM+' km':'-'}</div></div>${u.acquireTime?`<div class="modal-stat"><div class="modal-stat-label">Acquisizione</div><div class="modal-stat-value">${u.acquireTime}s</div></div>`:''}${u.guidance?`<div class="modal-stat"><div class="modal-stat-label">Guida</div><div class="modal-stat-value">${u.guidance}</div></div>`:''}${u.role?`<div class="modal-stat"><div class="modal-stat-label">Ruolo</div><div class="modal-stat-value">${u.role}</div></div>`:''}${u.shipType?`<div class="modal-stat"><div class="modal-stat-label">Tipo</div><div class="modal-stat-value">${u.shipType}</div></div>`:''}</div></div><div class="modal-section"><h3 class="modal-section-title">üéØ Identificazione</h3><div class="modal-stats-grid"><div class="modal-stat"><div class="modal-stat-label">RWR</div><div class="modal-stat-value">${u.rwrSymbol&&u.rwrSymbol!=='-'?`<span class="rwr-symbol">${u.rwrSymbol}</span>`:'-'}</div></div><div class="modal-stat"><div class="modal-stat-label">HARM</div><div class="modal-stat-value">${u.harmCode&&u.harmCode!=='-'?`<span class="harm-code">${u.harmCode}</span>`:'-'}</div></div>${u.countermeasure?`<div class="modal-stat"><div class="modal-stat-label">Contromisura</div><div class="modal-stat-value"><span class="countermeasure cm-${u.countermeasure.toLowerCase()}">${u.countermeasure}</span></div></div>`:''}</div></div>`;
            if(u.trackRadar||u.searchRadar||u.associatedSam) h+=`<div class="modal-section"><h3 class="modal-section-title">üì° Radar</h3><div class="modal-stats-grid">${u.trackRadar?`<div class="modal-stat"><div class="modal-stat-label">Track</div><div class="modal-stat-value" style="font-size:0.75rem;">${u.trackRadar}</div></div>`:''}${u.searchRadar?`<div class="modal-stat"><div class="modal-stat-label">Search</div><div class="modal-stat-value" style="font-size:0.75rem;">${u.searchRadar}</div></div>`:''}${u.associatedSam?`<div class="modal-stat"><div class="modal-stat-label">SAM</div><div class="modal-stat-value">${u.associatedSam}</div></div>`:''}</div></div>`;
            if(u.samSystems||u.ciws) h+=`<div class="modal-section"><h3 class="modal-section-title">üöÄ Armamento</h3><div class="modal-stats-grid">${u.samSystems?`<div class="modal-stat"><div class="modal-stat-label">SAM</div><div class="modal-stat-value" style="font-size:0.75rem;">${u.samSystems}</div></div>`:''}${u.ciws?`<div class="modal-stat"><div class="modal-stat-label">CIWS</div><div class="modal-stat-value">${u.ciws}</div></div>`:''}</div></div>`;
            if(u.ammo) h+=`<div class="modal-section"><h3 class="modal-section-title">üí• Munizioni</h3><div class="modal-stat" style="background:var(--bg-tertiary);padding:0.6rem;border-radius:5px;"><div class="modal-stat-value">${u.ammo}</div></div></div>`;
            document.getElementById('modal-body').innerHTML = h;
            modal.classList.add('active');
            
            // Setup pan + zoom effect for modal image
            const imgHeader = document.getElementById('modal-image');
            imgHeader.addEventListener('mousemove', (e) => {
                const img = imgHeader.querySelector('img');
                if (!img) return;
                const rect = imgHeader.getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width;
                const y = (e.clientY - rect.top) / rect.height;
                // Move opposite to mouse: center is 0.5, so (0.5 - x) gives opposite direction
                const moveX = (0.5 - x) * 80; // 80px max movement
                const moveY = (0.5 - y) * 50; // 50px max movement
                img.style.transform = `translate(${moveX}px, ${moveY}px) scale(1.5)`;
            });
            imgHeader.addEventListener('mouseleave', () => {
                const img = imgHeader.querySelector('img');
                if (img) img.style.transform = 'translate(0, 0) scale(1)';
            });
        }

        init();
    </script>
</body>
</html>
